name: Build and Deploy to Dev

on:
  pull_request:
    branches: [main]

jobs:
  build-and-push-server:
    uses: ./.github/workflows/build-and-push-servers.yml
    secrets: inherit
  build-and-push-clients:
    uses: ./.github/workflows/build-and-push-clients.yml
    secrets: inherit
  deploy-dev-container:
    needs: [build-and-push-clients, build-and-push-server]
    uses: ./.github/workflows/deploy-docker.yml
    secrets: inherit
    with:
      environment: prompt-dev-vm
      core_image_tag: ${{ needs.build-and-push-clients.outputs.core_image_tag }}
      template_image_tag: ${{ needs.build-and-push-clients.outputs.template_image_tag }}
      interview_image_tag: ${{ needs.build-and-push-clients.outputs.interview_image_tag }}
      matching_image_tag: ${{ needs.build-and-push-clients.outputs.matching_image_tag }}
      server_core_image_tag: ${{ needs.build-and-push-server.outputs.server_image_tag }}
      server_intro_course_image_tag: ${{ needs.build-and-push-server.outputs.server_intro_course_image_tag }}

