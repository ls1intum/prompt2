name: Lint Clients

on:
  workflow_call:

jobs:
  set-matrix:
    runs-on: ubuntu-latest
    outputs:
      modules: ${{ steps.set-matrix.outputs.modules }}
    steps:
      - uses: actions/checkout@v4
      - id: set-matrix
        run: echo "modules=$(find clients -mindepth 1 -maxdepth 1 -type d -exec test -e '{}/eslint.config.mjs' \; -print | jq -R -s -c 'split("\n")[:-1]')" >> "$GITHUB_OUTPUT"

  lint-client:
    needs: set-matrix
    name: Lint
    runs-on: ubuntu-latest
    strategy:
      matrix:
        module: ${{ fromJson(needs.set-matrix.outputs.modules) }}
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-node
      - run: yarn install
        working-directory: ./clients
      - name: Lint components in ${{ matrix.module }}
        run: yarn eslint "${{ matrix.module }}" --config "${{ matrix.module }}/eslint.config.mjs" --format json --output-file "lint-results/$(basename ${{ matrix.module }})-lint-results.json" || true
        continue-on-error: true
      - name: Upload Lint Results
        uses: actions/upload-artifact@v4
        with:
          name: lint-results
          path: clients/lint-results/*.json
